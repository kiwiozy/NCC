# S3 Storage Integration

**Status:** ‚úÖ Production Ready  
**Last Updated:** November 2025

---

## üìã **Overview**

AWS S3 integration provides secure document storage with presigned URLs for upload/download. All patient documents, AT reports, and files are stored in S3.

---

## üéØ **Features**

- ‚úÖ Secure file upload to S3
- ‚úÖ Presigned URLs for download (temporary, secure access)
- ‚úÖ File type validation
- ‚úÖ Backend proxy for CORS bypass (Safari PDF support)
- ‚úÖ Frontend IndexedDB caching for optimal performance

---

## üõ† **Implementation**

### **Backend**
- **App:** `backend/documents/`
- **Service:** `S3Service` (singleton, handles S3 operations)
- **Views:** Upload, download, proxy (for Safari)
- **Models:** `Document` (tracks metadata)

### **Frontend**
- **Component:** `frontend/app/components/dialogs/DocumentsDialog.tsx`
- **Features:** Drag-and-drop upload, inline PDF viewing, image viewing
- **Caching:** `frontend/app/utils/pdfCache.ts` (IndexedDB cache)

### **API Endpoints**
- `POST /api/documents/` - Upload document
- `GET /api/documents/{id}/` - Get document metadata
- `GET /api/documents/{id}/proxy/` - Proxy download (bypasses CORS)
- `DELETE /api/documents/{id}/` - Delete document

---

## üîë **Setup Requirements**

1. **AWS Console:**
   - Create S3 bucket (e.g., `walkeasy-nexus-documents`)
   - Create IAM user with S3 permissions
   - Generate access keys

2. **Environment Variables:**
   ```bash
   AWS_ACCESS_KEY_ID=your_access_key
   AWS_SECRET_ACCESS_KEY=your_secret_key
   AWS_STORAGE_BUCKET_NAME=walkeasy-nexus-documents
   AWS_S3_REGION_NAME=ap-southeast-2
   ```

3. **S3 Bucket CORS (Optional):**
   - For direct browser access (not needed if using proxy)
   - See: `docs/troubleshooting/CORS_FIX_S3_BUCKET.md`

---

## üìö **Full Documentation**

Detailed setup guides and implementation docs are archived in:
`docs/archive/legacy-integrations/S3 Integration/`

**Key Files:**
- `S3_INTEGRATION_COMPLETE.md` - Full implementation summary
- `S3_SETUP_GUIDE.md` - Setup steps

---

## üêõ **Troubleshooting**

### **"Access Denied" error**
- Check IAM user has correct permissions
- Verify bucket name matches environment variable
- Check AWS region is correct

### **CORS errors (Safari)**
- Use backend proxy endpoint (`/api/documents/{id}/proxy/`)
- Frontend automatically uses proxy for Safari
- See: `docs/troubleshooting/SAFARI_PDF_RENDERING_ISSUE.md`

### **Upload fails**
- Check file size limit (default 10MB)
- Verify bucket has write permissions
- Check S3 bucket region matches environment variable

---

**Status:** ‚úÖ Working in production with Safari PDF caching solution

